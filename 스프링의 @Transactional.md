----
**Transactionμ΄λ€ ν• λ¬Έμ¥μΌλ΅ μ •μν•΄ λ³΄λ©΄ λ°μ΄ν„°λ² μ΄μ¤μ μƒνƒλ¥Ό λ³€ν™”μ‹ν‚¤κΈ° μ„ν•΄μ„ μν–‰ν•λ” μ‘μ—…μ λ‹¨μ„λ¥Ό μλ―Έν•©λ‹λ‹¤.**

###### β…Springμ—μ„ μ κ³µν•λ” νΈλμ­μ…

1.  κ°λ°μ‹ νΈλμ­μ…
    -   νΈλμ­μ… λ§¤λ‹μ €μ—μ„ νΈλμ­μ…μ„ μ–»μ–΄μ¤λ” λ°©λ²•
    -   κ°€λ…μ„±μ„ λ–¨μ–΄λ¨λ¦¬κ³ , ν΄λ¨Όμ—λ¬κ°€ μ λ°λ  μ μμΌλ―€λ΅ μ μ‚¬μ©ν•μ§€ μ•μ.
2.  μ„ μ–Έμ  νΈλμ­μ… (μ–΄λ…Έν…μ΄μ…)
    -   μ¤ν”„λ§μ AOPλ¥Ό μ κ·Ήμ μΌλ΅ μ²΄κ°κ°€λ¥
    -   xmlμ—μ„ AOP μ„¤μ •μΌλ΅ νΈλμ­μ…μ„ μ„ μ–Έν•λ” λ°©λ²•
    -   μ–΄λ…Έν…μ΄μ… μ‚¬μ©λ°©λ²•(@Transactional)


μ¤ν”„λ§μ—μ„λ” `μ„ μ–Έμ  νΈλμ­μ…`μ„ μ‚¬μ©ν•λ‹¤. 

###### β… λ™μ‘μ›λ¦¬

- νΈλμ­μ…μ€ Spring AOP μ΄μ© (μ–΄λ…Έν…μ΄μ… κΈ°λ° AOP)
```java
import org.springframework.transaction
```

-    `@Transactional`μ΄ μ„ μ–Έλ ν΄λμ¤μ— λ€ν•΄ νΈλμ­μ…μ΄ μ μ©λ ==ν”„λ΅μ‹ κ°μ²΄ μƒμ„±==
-  λ©”μ„λ“ μ•λ’¤λ΅ νΈλμ­μ… λ΅μ§ μ‚½μ…
	- ν”„λ΅μ‹ κ°μ²΄λ” @Transactionalμ΄ ν¬ν•¨λ λ©”μ„λ“κ°€ νΈμ¶λ  κ²½μ°,==νΈλμ­μ…μ„ μ‹μ‘ν•κ³  Commit or Rollbackμ„ μν–‰==
-   CheckedException or μμ™Έκ°€ μ—†μ„ λ•λ” Commit
-   UncheckedExceptionμ΄ λ°μƒν•λ©΄ Rollback
	- RuntimeExceptionκ³Ό Errorκ°€ λ°μƒν–μ„μ‹ λ΅¤λ°±

[μ£Όμμ ]
- μ°μ„ μμ„
	- λ©”μ„λ“ μ„ μ–Έμ΄ κ°€μ¥ λ†’κ³  μΈν„°νμ΄μ¤ μ„ μ–Έμ΄ κ°€μ¥ λ‚®λ‹¤. 
	    β­ ν΄λμ¤ λ©”μ†λ“ -> ν΄λμ¤ -> μΈν„°νμ΄μ¤ λ©”μ†λ“ -> μΈν„°νμ΄μ¤
		* μΈν„°νμ΄μ¤ λ³΄λ‹¤λ” ν΄λμ¤μ— κ¶κ³  
* νΈλμ­μ…μ λ¨λ“
	* Proxy Mode(Default) / AspectJ Mode 
	* Proxy Mode λ™μ‘ν•μ§€ μ•λ” κ²½μ°
		- public λ©”μ†λ“ μ—λ§ μ μ©μ΄ λλ‹¤ (proteced, private μ€ μ—λ¬λ” μ•λ‚μ§€λ§ λ™μ‘ μ•ν•¨)
		- non-public μ— μ μ©ν•κ³  μ‹¶λ‹¤λ©΄ AspectJ Mode κ³ λ ¤
	- @Transactional μ΄ μ μ©λμ§€ μ•μ€ public method μ—μ„ @Transactional μ΄ μ μ©λ Public method νΈμ¶μ‹ νΈλμ­μ…μ΄ λ™μ‘ν•μ§€ μ•μ. 


###### β… μ–΄λ…Έν…μ΄μ… μ‚¬μ© λ°©λ²•
* μΌλ°μ μΌλ΅ λ§μ΄ μ‚¬μ©ν•λ” μ„ μ–Έμ  νΈλμ­μ… λ°©μ‹
	* `@Transactional` μ‚¬μ©ν•κ³  μ‹¶μΌλ©΄ `@EnableTransactionManagement`λ¥Ό μ¶”κ°€ν•κ³  μ‚¬μ©
		* spring boot λ” μλ™μΌλ΅ μ„¤μ •λμ–΄ μμ
	- 

[νΉμ„±]
![[Pasted image 20230329085626.png]]

###### β… μ‚¬μ© μμ‹
* ν•λ‚μ μ‘μ—… or μ—¬λ¬ μ‘μ—…
* ν•λ‚μ μ‘μ—…μ„ λ‹¨μ„λ΅ λ¬¶μ–΄ commit or rollback μ²λ¦¬ ν•„μ” 

- JPA λ¥Ό μ‚¬μ©ν•λ©΄ @Transactional μ§μ ‘ μ„ μ–Έ ν•„μ” μ—†μ
	- κµ¬ν„μ²΄μ— μ΄λ―Έ μ„ μ–Έμ΄ λμ–΄ μμ–΄ rollback μ„ μλ™μΌλ΅ ν•΄μ¤. 

> μ„ μ–Έμ  νΈλμ­μ… λ°©μ‹μ„ μ‚¬μ©ν•λ” μ΄μ ? 

λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ νΈλμ­μ… μ²λ¦¬λ¥Ό ν•„μ”λ΅ ν•  λ•, νΈλμ­μ… μ²λ¦¬ μ½”λ“μ™€ λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ κ³µμ΅΄ν•λ‹¤λ©΄ μ½”λ“ μ¤‘λ³µμ΄ λ°μƒν•κ³  λΉ„μ¦λ‹μ¤ λ΅μ§μ— μ§‘μ¤‘ν•κΈ° μ–΄λ µλ‹¤. λ”°λΌμ„ νΈλμ­μ… μ²λ¦¬μ™€ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ λ¶„λ¦¬ν•  μ μλ” μ„ μ–Έμ  νΈλμ­μ… λ°©μ‹μ„ μμ£Ό μ‚¬μ©ν•λ‹¤. (π”ΈSpring AOP)

> @Transactional λ™μ‘ μ›λ¦¬λ”? 

@Transactionalμ„ λ©”μ†λ“ λλ” ν΄λμ¤μ— λ…μ‹ν•λ©΄ AOPλ¥Ό ν†µν•΄ Targetμ΄ μƒμ†ν•κ³  μλ” μΈν„°νμ΄μ¤ λλ” Target κ°μ²΄λ¥Ό μƒμ†ν• Proxy κ°μ²΄κ°€ μƒμ„±λλ©°, Proxy κ°μ²΄μ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ©΄ Target λ©”μ†λ“ μ „ ν›„λ΅ νΈλμ­μ… μ²λ¦¬λ¥Ό μν–‰ν•λ‹¤.

> @Transactional μ‚¬μ© μ‹ μ£Όμ μ‚¬ν•­μ€? 

-   Proxy κ°μ²΄μ Target Methodκ°€ λ‚΄λ¶€ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ©΄ ==μ‹¤μ  λ©”μ†λ“κ°€ νΈμ¶λκΈ° λ•λ¬Έμ— Inner Methodμ—μ„ @Transactional μ–΄λ…Έν…μ΄μ…μ΄ μ μ©λμ§€ μ•λ” κ²ƒ==μ„ μ£Όμν•΄μ•Ό ν•λ‹¤.
-   @Transactional μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ΄λ©΄ νΈλμ­μ… μ²λ¦¬λ¥Ό μ„ν•΄ Proxy κ°μ²΄λ¥Ό μƒμ„±ν•λ”λ°, Proxyλ” Target Classλ¥Ό μƒμ†ν•μ—¬ μƒμ„±λλ‹¤. λ”°λΌμ„ ==μƒμ†μ΄ λ¶κ°€λ¥ν• Private λ©”μ†λ“μ κ²½μ° @Transactional μ–΄λ…Έν…μ΄μ…μ„ μ μ©ν•  μ μ—†λ‹¤λ” κ²ƒμ„ μ£Όμ==ν•΄μ•Ό ν•λ‹¤.

> @Transactionalλ¥Ό μ¤ν”„λ§ Beanμ λ©”μ†λ“ Aμ— μ μ©ν•μ€κ³ , ν•΄λ‹Ή Beanμ λ©”μ†λ“ Bκ°€ νΈμ¶λμ—μ„ λ•, B λ©”μ†λ“ λ‚΄λ¶€μ—μ„ A λ©”μ†λ“λ¥Ό νΈμ¶ν•λ©΄ μ–΄λ–¤ μ”μ²­ νλ¦„μ΄ λ°μƒν•λ”μ§€ μ„¤λ…ν•λΌ.

ν”„λ΅μ‹λ” ν΄λΌμ΄μ–ΈνΈκ°€ ==νƒ€κ² κ°μ²΄λ¥Ό νΈμ¶ν•λ” κ³Όμ •μ—λ§ λ™μ‘==ν•λ©°, νƒ€κ² κ°μ²΄μ λ©”μ†λ“κ°€ μκΈ° μμ‹ μ λ‹¤λ¥Έ λ©”μ†λ“λ¥Ό νΈμ¶ν•  λ•λ” ν”„λ΅μ‹κ°€ λ™μ‘ν•μ§€ μ•λ”λ‹¤. 
μ¦‰ A λ©”μ†λ“λ” ν”„λ΅μ‹λ΅ κ°μ‹Έμ§„ λ©”μ†λ“κ°€ μ•„λ‹λ―€λ΅ νΈλμ­μ…μ΄ μ μ©λμ§€ μ•λ” μΌλ° μ½”λ“κ°€ μν–‰λλ‹¤.

> AλΌλ” Service κ°μ²΄μ λ©”μ†λ“κ°€ μ΅΄μ¬ν•κ³ , κ·Έ λ©”μ†λ“ λ‚΄λ¶€μ—μ„ λ΅μ»¬ νΈλμ­μ… 3κ°(λ‹¤λ¥Έ Service κ°μ²΄μ νΈλμ­μ… λ©”μ†λ“λ¥Ό νΈμ¶ν–λ‹¤λ” μλ―Έ)κ°€ μ΅΄μ¬ν•λ‹¤κ³  ν•  λ•, @Transactionalμ„ A λ©”μ†λ“μ— μ μ©ν•λ©΄ μ–΄λ–¤ μ”μ²­ νλ¦„μ΄ λ°μƒν•λ”μ§€ μ„¤λ…ν•λΌ.

νΈλμ­μ… μ „ν μμ¤€μ— λ”°λΌ λ‹¬λΌμ§„λ‹¤. λ§μ•½ κΈ°λ³Έ μµμ…μΈ REQUIREDλ¥Ό κ°€μ Έκ°„λ‹¤λ©΄ λ΅μ»¬ νΈλμ­μ… 3κ°κ°€ λ¨λ‘ λ¶€λ¨ νΈλμ­μ…μΈ Aμ— ν•©λ¥ν•μ—¬ μν–‰λλ‹¤. κ·Έλμ„ ==λ¶€λ¨ νΈλμ­μ…μ΄λ‚ λ΅μ»¬ νΈλμ­μ… 3κ°λ‚ λ¨λ‘ κ°™μ€ νΈλμ­μ…μ΄λ―€λ΅ μ–΄λ ν•λ‚μ λ΅μ§μ—μ„λ“  λ¬Έμ κ°€ λ°μƒν•λ©΄ μ „λ¶€ λ΅¤λ°±==μ΄ λλ‹¤.

μ „ν λ‹¨κ³„λ” REQUIRED, REQUIRES_NEW, MANDATORY, NESTED, NEVER, SUPPORTS, NOT_SUPPORTED κ°€ μμµλ‹λ‹¤. 

μ „ν λ‹¨κ³„ μ„¤λ… : https://deveric.tistory.com/86

-----
https://resilient-923.tistory.com/415
https://beaniejoy.tistory.com/68



